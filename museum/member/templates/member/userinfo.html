{% extends 'main/base.html' %}
{% load crispy_forms_tags %}

{% block title %} ë§ˆì§€ë§‰ {% endblock %}

{% block content %}
<div class="row-h-80"></div>

<div class="row justify-content-center">
    <div class="col-11 col-md-6">
        <div class="row">
            <div class="col">
                {% if update_mode %}
                <div class="text-xl">ë‚˜ì— ëŒ€í•´<br> ë” í’ì„±í•˜ê²Œ.</div>
                {% else %}
                <div class="text-xl">ê°€ì¥ ì¤‘ìš”í•œ<br>ë§ˆì§€ë§‰ ë‹¨ê³„.</div>
                {% endif %}
            </div> 
        </div>
        <div class="row-h-20"></div>
        <div class="row">
            <div class="col">
                <form method='post' class='form-group' enctype="multipart/form-data"> {% csrf_token %}
                    {% if update_mode %}
                    <div class="row">
                        <div class="col text-m">
                            <button type='button' onclick="ShowImageField()" class="btn btn-menial" id='show_img_field'>í”„ë¡œí•„ ì‚¬ì§„ ë³€ê²½</button>
                            {{form.profile_image|as_crispy_field}}
                            <div class="text-s warning" id='profile-img-instruction'>ì •ì‚¬ê°í˜• ëª¨ì–‘ì˜ ì´ë¯¸ì§€ë§Œ ì˜¬ë ¤ì£¼ì„¸ìš”!</div>
                        </div>
                    </div>
                    <div class="row-h-20"></div>
                    {% else %}
                    {% endif %}
                    <div class="row">
                        <div class="col text-m">
                            {{form.real_name|as_crispy_field}}
                        </div>
                    </div>
                    <div class="row-h-20"></div>
                    {% if update_mode %}
                    <div class="row">
                        <div class="col text-m">
                            {{form.self_intro|as_crispy_field}}
                        </div>
                    </div>
                    <div class="row-h-20"></div>
                    {% else %}
                    {% endif %}
                    {% if update_mode %}
                    <div class="row">
                        <div class="col text-m">
                            {{form_additional.best_book|as_crispy_field}}
                        </div>
                    </div>
                    <div class="row-h-20"></div>
                    <div class="row">
                        <div class="col text-m">
                            {{form_additional.thoughts|as_crispy_field}}
                        </div>
                    </div>
                    <div class="row-h-20"></div>
                    <div class="row">
                        <div class="col text-m">
                            {{form_additional.enthusiasm|as_crispy_field}}
                        </div>
                    </div>
                    <div class="row-h-40"></div>
                    {% else %}
                    {% endif %}
                    <div class="row">
                        <div class="col text-m">
                            ë‚˜ë¥¼ ê°€ì¥ ì˜ ë¬˜ì‚¬í•˜ëŠ” ê±¸ ê³¨ë¼ì£¼ì„¸ìš”.*
                        </div>
                    </div>
                    <div class="row row-topless">
                        <div class="col text-m">
                            <div class="card card-body" style="padding-top:0px; padding-bottom:0px;">
                                {{form.persona_type|as_crispy_field}}
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col right">
                            {% if update_mode %}
                            <button class="btn btn-primary" type='submit'>ì €ì¥í•˜ê¸°</button>
                            {% else %}
                            <button class="btn btn-primary" type='submit'>ì˜¤ë¦¬ì§€ë„ìŠ¤ ì‹œì‘í•˜ê¸°</button>
                            {% endif %}
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
<div class="row-h-40"></div>
{% if update_mode %}
<div class="row justify-content-center">
    <div class="col center">
        <a href='/logout' class="underline">ë¡œê·¸ì•„ì›ƒ</a>
    </div>
</div>
{% else %}
{% endif %}

<script>
    function changeForm() {
        // placeholder ë³€ê²½
        document.getElementById('id_real_name').placeholder = 'ì˜¤ë¦¬ì§€ë„ìŠ¤ ë‚´ì—ì„œ ì“°ì¼ ì´ë¦„ì´ì—ìš”.';
        
        // label ë³€ê²½ -- initial_mode
        
        document.getElementsByTagName('label')[1].innerText = "";
        
        // label ë³€ê²½ -- update_mode
        var isUpdateMode = '{{update_mode}}'
        if (isUpdateMode) {
            document.getElementById('div_id_profile_image').style.display = 'none';

            document.getElementsByTagName('label')[0].innerText = "ê¸°ë³¸ ì‚¬ì§„ìœ¼ë¡œ";
            document.getElementsByTagName('label')[1].innerText = "ì´ë¦„*";
            document.getElementsByTagName('label')[2].innerText = "ì§§ì€ ì†Œê°œ";
            document.getElementsByTagName('label')[3].innerText = "ğŸ“š ìš”ì¦˜ ì½ì€ ì±…";
            document.getElementsByTagName('label')[4].innerText = "ğŸ’¬ ìš”ì¦˜ í•˜ëŠ” ìƒê°";
            document.getElementsByTagName('label')[5].innerText = "ğŸ”¥ ìš”ì¦˜ ì—´ì‹¬íˆ í•˜ëŠ” ê²ƒ";
            document.getElementsByTagName('label')[6].innerText = "";
        }
    }
    changeForm();

    function hideSelfQuesBtn() {
        document.getElementById('self-ques-btn').style.display = 'none';
    }
    hideSelfQuesBtn();

    // Non-member ë‹µë³€ í™•ì¸ (local storage)
    function checkLocalStorage() {
        
        if (localStorage.getItem('non-member-object')) {

            var lsItem = localStorage.getItem('non-member-object')
            var lsItemArr = JSON.parse(lsItem)

            var postData = {
                body : lsItemArr[0],
                created_at : lsItemArr[1],
                is_shared : lsItemArr[2],
            }

            $.ajax({
                type: "POST",
                dataType: 'json',
                url: '{% url "non-member-answer" %}',
                data : JSON.stringify(postData)
            })

            localStorage.removeItem('non-member-object')
        }
    }
    checkLocalStorage();

    // ì´ë¯¸ì§€ í•„ë“œ ì²˜ë¦¬
    document.getElementById('div_id_profile_image').style.display = 'none';
    document.getElementById('profile-img-instruction').style.display = 'none';

    document.getElementById('profile_image-clear_id').style.display = 'none';
    document.getElementsByTagName('label')[0].style.display = 'none';
    
    function ShowImageField() {
        document.getElementById('show_img_field').style.display = 'none';
        document.getElementById('div_id_profile_image').style.display = 'inline-block';
        document.getElementById('profile-img-instruction').style.display = 'inline-block';
        
    }

</script>
{%endblock%}